<html>
    <head>
        <title>Chat</title>
        <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    </head>
    <style>
        body {
            background-color: RGB(0, 150, 150);
            -webkit-text-fill-color: white;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            background-color: rgb(55,55,55,0.5);
            margin: 0 auto;
            text-align: center;
            max-width: 800px;
            padding: 10px 20px;
            border: 2px solid white;
            border-radius: 10px;
        }
        input {
            -webkit-text-fill-color: black;
        }
        button {
            background-color: black;
            border: 1.5px solid white;
            border-radius: 8px;
            padding: 10px 20px;
            transition: transform 0.5s, background-color 0.5s, -webkit-text-fill-color 0.5s, border 0.5s;
            font-size: 1rem;
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            cursor: pointer;
        }
        button:hover {
            transform: scale(1.25);
            background-color: white;
            -webkit-text-fill-color: black;
            border: 1.5px solid black;
        }
        button:active {
            transform: scale(0.75);
        }
    </style>
    <body>
        <div class="container">
            <div id="chat-box"></div>
            <form id="message-form">
                <input type="text" id="message" placeholder="Scrivi un messaggio..." autocomplete="off" required>
                <button type="submit">Invia!</button>
            </form>
        </div>

        <script>
        const socket = io();
        const username = "{{ username }}";
        const room = "{{ room }}";

        // Entra nella stanza
        socket.emit('join', { username, room });

        // Ricevi messaggi
        socket.on('message', data => {
            const chatBox = document.getElementById('chat-box');
            const msg = document.createElement('p');
            msg.innerHTML = data.username ? `<strong>${data.username}:</strong> ${data.msg}` : `<em>${data.msg}</em>`;
            chatBox.appendChild(msg);
            chatBox.scrollTop = chatBox.scrollHeight;
        });

        // Invia messaggio
        document.getElementById('message-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const input = document.getElementById('message');
            const msg = input.value;
            if (msg.trim() !== "") {
                socket.emit('message', { username, room, msg });
                input.value = "";
            }
        });
    </script>
    </body>
</html>